<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WebOS Lite</title>
<style>
  /* Basic reset */
  body, html {
    margin: 0; padding: 0; height: 100%;
    background: #008080;
    font-family: Arial, sans-serif;
    user-select: none;
  }

  #desktop {
    position: relative;
    width: 100%;
    height: 100%;
    padding: 20px;
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }

  .icon {
    width: 80px;
    height: 80px;
    background: #eee;
    border-radius: 10px;
    box-shadow: 2px 2px 6px rgba(0,0,0,0.3);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 30px;
    cursor: pointer;
    flex-direction: column;
    user-select: none;
  }

  .icon:hover {
    background: #ddd;
  }

  .window {
    position: absolute;
    top: 50px;
    left: 50px;
    width: 400px;
    height: 300px;
    background: white;
    border: 2px solid #444;
    box-shadow: 0 0 10px rgba(0,0,0,0.6);
    display: flex;
    flex-direction: column;
  }

  .title-bar {
    background: #444;
    color: white;
    padding: 5px 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: move;
    user-select: none;
  }

  .window-content {
    padding: 10px;
    flex-grow: 1;
    overflow: auto;
  }

  textarea {
    flex-grow: 1;
    width: 100%;
    border: none;
    resize: none;
    font-family: monospace;
    font-size: 14px;
    padding: 10px;
  }

  /* Terminal styles */
  #terminal .window-content {
    background: #000;
    color: #0f0;
    font-family: monospace;
    padding: 10px;
    display: flex;
    flex-direction: column;
  }

  #terminal-output {
    flex-grow: 1;
    overflow-y: auto;
  }

  #terminal-input {
    width: 100%;
    background: #000;
    color: #0f0;
    border: none;
    outline: none;
    font-family: monospace;
    padding: 5px;
  }
</style>
</head>
<body>

<div id="desktop">
  <!-- Desktop Icons -->
  <div class="icon" onclick="openApp('fileExplorer')">üìÅ File Explorer</div>
  <div class="icon" onclick="openApp('notepad')">üìù Notepad</div>
  <div class="icon" onclick="openTerminal()">üíª Terminal</div>
</div>

<!-- File Explorer Window -->
<div id="fileExplorer" class="window" style="display:none;">
  <div class="title-bar">
    <span>File Explorer</span>
    <button onclick="closeApp('fileExplorer')">X</button>
  </div>
  <div class="window-content" id="file-explorer-content"></div>
</div>

<!-- Notepad Window -->
<div id="notepad" class="window" style="display:none;">
  <div class="title-bar">
    <span>Notepad</span>
    <button onclick="closeApp('notepad')">X</button>
  </div>
  <textarea id="notepad-text" rows="10" cols="40"></textarea>
</div>

<!-- Terminal Window -->
<div id="terminal" class="window" style="display:none; width: 600px; height: 400px;">
  <div class="title-bar">
    <span>Terminal</span>
    <button onclick="closeApp('terminal')">X</button>
  </div>
  <div class="window-content" id="terminal-content">
    <div id="terminal-output"></div>
    <input type="text" id="terminal-input" autocomplete="off" spellcheck="false" />
  </div>
</div>

<script>
// ========== Fake File System ==========

const fileSystem = {
  "root": [
    { type: "folder", name: "Documents", contents: [
      { type: "file", name: "readme.txt", content: "Welcome to WebOS Lite! This is a fake file system." },
      { type: "file", name: "todo.txt", content: "1. Build cool apps\n2. Have fun\n3. Repeat" }
    ]},
    { type: "file", name: "hello.txt", content: "Hello from the root folder!" }
  ]
};

let currentPath = ["root"];

// ========== App Window Controls ==========

function openApp(appId) {
  document.getElementById(appId).style.display = "flex";
  if (appId === "fileExplorer") renderFileExplorer();
  if (appId === "terminal") openTerminal();
}

function closeApp(appId) {
  document.getElementById(appId).style.display = "none";
}

// ========== File Explorer ==========

function renderFileExplorer() {
  const container = document.getElementById("file-explorer-content");
  container.innerHTML = "";

  // Show path
  const pathBar = document.createElement("div");
  pathBar.style.marginBottom = "10px";
  pathBar.textContent = "/" + currentPath.slice(1).join("/");
  container.appendChild(pathBar);

  // Back button
  if (currentPath.length > 1) {
    const backBtn = document.createElement("button");
    backBtn.textContent = "‚¨ÖÔ∏è Back";
    backBtn.onclick = () => {
      currentPath.pop();
      renderFileExplorer();
    };
    container.appendChild(backBtn);
  }

  // List files/folders
  const folder = getFolderAtPath(currentPath);
  folder.forEach(item => {
    const itemDiv = document.createElement("div");
    itemDiv.style.padding = "5px";
    itemDiv.style.cursor = "pointer";
    itemDiv.textContent = item.type === "folder" ? "üìÅ " + item.name : "üìÑ " + item.name;

    itemDiv.onclick = () => {
      if (item.type === "folder") {
        currentPath.push(item.name);
        renderFileExplorer();
      } else if (item.type === "file") {
        openFileInNotepad(item);
      }
    };

    container.appendChild(itemDiv);
  });
}

function getFolderAtPath(path) {
  let folder = fileSystem;
  for (let i = 0; i < path.length; i++) {
    if (i === 0) {
      folder = fileSystem[path[i]];
    } else {
      const next = folder.find(f => f.type === "folder" && f.name === path[i]);
      folder = next ? next.contents : [];
    }
  }
  return folder || [];
}

function openFileInNotepad(file) {
  openApp("notepad");
  const textarea = document.getElementById("notepad-text");
  textarea.value = file.content || "";
}

// ========== Draggable Windows ==========

document.querySelectorAll('.window').forEach(win => {
  let isDragging = false;
  let offset = { x: 0, y: 0 };

  const bar = win.querySelector('.title-bar');
  bar.addEventListener('mousedown', e => {
    isDragging = true;
    offset.x = e.clientX - win.offsetLeft;
    offset.y = e.clientY - win.offsetTop;
  });

  document.addEventListener('mousemove', e => {
    if (isDragging) {
      win.style.left = `${e.clientX - offset.x}px`;
      win.style.top = `${e.clientY - offset.y}px`;
    }
  });

  document.addEventListener('mouseup', () => isDragging = false);
});

// ========== Fake Unix Terminal ==========

const unixFS = {
  "/": {
    type: "folder",
    contents: {
      bin: { type: "folder", contents: { "ls": { type: "file", content: "List directory contents" } } },
      etc: { type: "folder", contents: {} },
      home: { type: "folder", contents: {
        user: { type: "folder", contents: {
          "readme.txt": { type: "file", content: "Welcome to your fake Unix home!" }
        }}
      }},
      usr: { type: "folder", contents: {} },
      var: { type: "folder", contents: {} }
    }
  }
};

let currentDir = "/home/user";

function openTerminal() {
  openApp("terminal");
  printToTerminal(`Welcome to WebOS Lite Terminal\nType 'help' for commands\n\n`);
  setPrompt();
}

function setPrompt() {
  const input = document.getElementById("terminal-input");
  input.value = "";
  input.placeholder = `${currentDir} $ `;
  input.focus();
}

function printToTerminal(text) {
  const output = document.getElementById("terminal-output");
  output.innerHTML += text.replace(/\n/g, "<br>") + "<br>";
  output.parentElement.scrollTop = output.parentElement.scrollHeight; // scroll down
}

document.getElementById("terminal-input").addEventListener("keydown", function(e) {
  if (e.key === "Enter") {
    const command = e.target.value.trim();
    if (command) {
      printToTerminal(`<span style="color:#0ff;">${currentDir} $</span> ${command}`);
      handleCommand(command);
    }
    e.target.value = "";
  }
});

function handleCommand(input) {
  const args = input.split(" ");
  const cmd = args[0];
  const params = args.slice(1);

  switch(cmd) {
    case "help":
      printToTerminal("Available commands: ls, cd, pwd, cat, clear, help");
      break;
    case "ls":
      listDir();
      break;
    case "pwd":
      printToTerminal(currentDir);
      break;
    case "cd":
      changeDir(params[0]);
      break;
    case "cat":
      catFile(params[0]);
      break;
    case "clear":
      clearTerminal();
      break;
    default:
      printToTerminal(`Command not found: ${cmd}`);
  }
}

function getDir(path) {
  if (!path) path = currentDir;
  const parts = path.split("/").filter(Boolean);
  let dir = unixFS["/"];
  for (const part of parts) {
    if (dir.contents[part] && dir.contents[part].type === "folder") {
      dir = dir.contents[part];
    } else {
      return null;
    }
  }
  return dir;
}

function listDir() {
  const dir = getDir(currentDir);
  if (!dir) {
    printToTerminal("Directory not found");
    return;
  }
  const items = Object.keys(dir.contents);
  printToTerminal(items.join("  "));
}

function changeDir(target) {
  if (!target) {
    currentDir = "/home/user";
    setPrompt();
    return;
  }
  if (target === "..") {
    if (currentDir !== "/") {
      currentDir = currentDir.split("/").slice(0, -1).join("/");
      if (currentDir === "") currentDir = "/";
    }
  } else if (target.startsWith("/")) {
    if (getDir(target)) {
      currentDir = target;
    } else {
      printToTerminal(`No such directory: ${target}`);
    }
  } else {
    const newPath = currentDir.endsWith("/") ? currentDir + target : currentDir + "/" + target;
    if (getDir(newPath)) {
      currentDir = newPath;
    } else {
      printToTerminal(`No such directory: ${target}`);
    }
  }
  setPrompt();
}

function catFile(filename) {
  if (!filename) {
    printToTerminal("Specify a file");
    return;
  }
  const dir = getDir(currentDir);
  if (!dir) {
    printToTerminal("Directory not found");
    return;
  }
  if (dir.contents[filename] && dir.contents[filename].type === "file") {
    printToTerminal(dir.contents[filename].content);
  } else {
    printToTerminal(`No such file: ${filename}`);
  }
}

function clearTerminal() {
  document.getElementById("terminal-output").innerHTML = "";
}
</script>

</body>
</html>
